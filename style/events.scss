/**
 * Orchestra member, musicion and project management application.
 *
 * CAFEVDB -- Camerata Academica Freiburg e.V. DataBase.
 *
 * @author Claus-Justus Heine
 * @copyright 2011-2016, 2020, 2021, 2023 Claus-Justus Heine <himself@claus-justus-heine.de>
 * @license AGPL-3.0-or-later
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 */

@use "sass:list";

@import 'color-palette.scss';

#events {

  $dialog-title-bar-height: 39px;
  $event-controls-height: 39px;

  padding: 0;
  margin: 0;

  background-color:#d0dcec;

  position:relative;
  height: calc(100% - #{$dialog-title-bar-height})!important;
  max-height: calc(100% - #{$dialog-title-bar-height})!important;

  form.projectevents {

    height: 100%;
    position: relative;

    div.eventcontrols {
      padding:0.3em 0.3em 0 0.3em;
      min-height: $event-controls-height;
      height: $event-controls-height;
      min-width:360px;
    }

    div.eventlist {
      position: relative;
      height: calc(100% - #{$event-controls-height})!important;
      max-height: calc(100% - #{$event-controls-height})!important;
      scrollbar-width: auto;
    }

    div.event-list-container {
      display:inline-block;
      width:auto;
      min-width:100%;
      padding:0.3em;
      .heading.listing.empty {
        font-weight:normal;
        opacity:0.3;
      }
      .heading.listing {
        font-weight:bold;
      }
    }
    div.table-container {
      display:inline-block;
      width:auto;
      min-width:100%;
      padding:0;
      margin:0;
      /* overflow:hidden; ?? */
      border:0;
    }
    table.listing {
      border:0px solid #004d9c;
      border-collapse:collapse;
      border-spacing:0px;
      /* margin:1px; /  otherwise the cell-borders are hidden.*/
    }

    select, input, option, button {
      &:not(.event-actions .action-menu-toggle) {
        border-radius:4px;
        &, &:hover {
          background-color:#F4F4F4 !important;
        }
      }
    }

    .new-event.dropdown-container {
      .action-menu-toggle {
        background-image:url('../../../core/img/actions/add.svg');
        &:hover {
          border: 1px solid;
        }
        margin: 3px 3px 3px 0;
      }
    }

    .event-actions.dropdown-container {
      display: inline-block;
      max-height: 24px;
      margin: -3px 0 -3px 0;
      overflow: visible;
      .action-menu-toggle {
        min-height: 0;
        width: 30px;
        height: 30px;
      }
      .event-action {
        .menu-item-label {
          padding-left: 24px;
          background-position: left center;
          background-repeat: no-repeat;
          background-size: 16px;
        }
        &.event-action-select {
          input.email-check:checked ~ label .label-unchecked {
            display: none !important;
          }
          input.email-check:not(:checked) ~ label .label-checked {
            display: none !important;
          }
        }
        &.event-action-calendar-app {
          .menu-item-label {
            background-image: url(../img/calendar-dark.svg);
          }
        }
        &.event-action-edit {
          .menu-item-label {
            background-image: url(../img/pme-change.png);
          }
        }
        &.event-action-clone {
          .menu-item-label {
            background-image: url(../img/pme-copy.png);
          }
        }
        &.event-action-delete {
          .menu-item-label {
            background-image: url(../img/pme-delete.png);
          }
        }
        &.event-action-detach {
          .menu-item-label {
            background-image: url(../img/link_break16x16.png);
          }
        }
      }
      label {
        text-align: left;
        display: flex;
        align-items: center;
        &::before {
          margin: 0 8px 0 1px;
        }
      }
      nav {
        left:unset;
        position:fixed;
      }
    }



    .cafevdb-menu {
      &.chosen-container {
	margin-right:3px;
      }

      &.chosen-container .chosen-drop {
	background-color:#F4F4F4 !important;
      }

      &.chosen-container-single.chosen-with-drop .chosen-single {
	border-bottom-right-radius:0px;
	border-bottom-left-radius:0px;
	background-size:100% auto;
      }

      &.chosen-container a.chosen-single {
	border-radius:4px;
	background-color:#F4F4F4 !important;
	padding-top:5px !important;
	padding-bottom:5px !important;
	margin-top:3px !important;
	margin-bottom:3px !important;
      }

      &.chosen-containeru a.chosen-single:hover,
      &.chosen-container a.chosen-single:focus {
	background-color:#F4F4F4 !important;
	color:#333;
      }
    }

    input:active, option:active, button:active {
      background-color:SteelBlue;
    }

    tr, tr:hover, tr:active {
      background-color:inherit;
    }

    div.topbuttons {
      padding:1em 0.3em 0 0.3em;
    }

    input.projectevents-sendmail,
    input[type="submit"],
    input[type="button"],
    button {
      &:not(.event-actions .action-menu-toggle) {
        height:28px;
        vertical-align:middle;
      }
    }

    .image-button {
      background-repeat:no-repeat;
      background-position:center;
      width:28px;
      height:28px;
      vertical-align:middle;
      font-size:0pt;
      min-height:unset;
    }

    input.projectevents-sendmail-deselect[type=button] {
      background-image:url('../img/e_mail_X.png');
    }

    input.projectevents-sendmail-select[type=button] {
      background-image:url('../img/e_mail_checked.png');
    }

    input.projectevents-download {
      background-image:url('../../../core/img/actions/download.svg');
    }

    span.projectevents-reload {
      float:right;
      input.projectevents-reload {
        background-image: url(../img/reload-solid.svg);
        background-size: 24px;
        &.loading {
          background-image:url('../../../core/img/loading.gif');
        }
      }
    }

    /* Larger button */
    input.projectevents-sendmail[type=button] {
      background-image:url('../img/e_mail.png');
      background-repeat:no-repeat;
      background-position:0px;
      padding: 4px 14px 4px 24px;
      min-height:28px;
      vertical-align:middle;
    }

    input.email-check[type=checkbox] {
      display:none;
      /* visibility:hidden; */
      /* position:fixed; */
      /* left:0px; */
      /* top:0px; */
    }
    div.email-check {
      width:24px;
      height:24px;
      /*padding:0px;*/
      background:url(../img/e_mail.png);
      cursor:pointer;
      /*font-size:0;*/
      /*vertical-align:middle;*/
    }
    input.email-check[type=checkbox]:checked ~ div.email-check {
      width:24px;
      height:24px;
      /*padding:0px;*/
      background:url(../img/e_mail_checked.png);
      /*cursor:crosshair;*/
      /*font-size:0;*/
      /*vertical-align:middle;*/
    }

    label.email-check {
      /*vertical-align:middle;*/
    }

    table.listing {

      tr {
        &[data-action-scope="related"] {
          &.event-has-cross-series-relations {
            .scope-related-disabled {
              &, * {
                opacity: 0.5;
                pointer-events: none;
                cursor: not-allowed;
              }
            }
          }
          .scope-related-invisible {
            display:none;
          }
        }
        &[data-action-scope="series"] {
          .scope-series-invisible {
            display:none;
          }
        }
        &[data-action-scope="single"] {
          &.event-is-repeating {
            .repeating-scope-single-disabled {
              &, * {
                opacity: 0.5;
                pointer-events: none;
                cursor: not-allowed;
              }
            }
          }
          .scope-single-invisible {
            display:none;
          }
        }
        &.event-is-not-repeating .only-repeating {
          display:none;
        }
        &.event-has-no-cross-series-relations .only-cross-series-relations {
          display:none;
        }
        &.event-is-not-repeating.event-has-no-cross-series-relations .only-multi-scope {
          display:none;
        }

        &.step-0, &.step-1 {
          td {
            /*vertical-align:middle;*/
            border:1px solid #004d9c;
            padding:3px;
            @for $index from 1 through 8 {
              &.event-series-uid-#{$index - 1}, &.event-uid-#{$index - 1} {
                color: list.nth($colorPalette, $index);
                background-color: list.nth($colorPalette, $index);
              }
            }
            &.event-uid, &.event-series-uid {
              min-width:16px;
              width:16px;
              .uid-index, .series-uid-index {
                filter: invert(100%);
                background-color: rgba(1, 1, 1, 0);
              }
            }

            &.eventbuttons, &.eventemail {
              text-align:center;
              width:0.1%;
              white-space:nowrap;
            }

            &.eventdata {
              cursor:pointer;
            }

            &.eventdata-date {
              max-height:1em;
              width:10.5em !important;
            }

            /* Hide everything but the first line*/
            &.eventdata-brief {
              max-width:18.5em;
              min-width:18.5em;
              max-height:1em;
              /* white-space:normal; */
              overflow:hidden;
              text-overflow:ellipsis !important;
              vertical-align:middle;
            }
          } // td

          &.event-is-not-repeating:hover td.event-uid, &.event-has-no-cross-series-relations:hover td.event-series-uid {
            background-color: #9BAFC8!important;
          }

          &:hover td:not(.event-uid, .event-series-uid) {
            background-color: #9BAFC8!important;
          }

          &.event-is-repeating td.event-uid, &.event-has-cross-series-relations td.event-series-uid {
            &, & * {
              cursor: pointer;
            }
          }
        }

        &.step-0 td {
          background:#B7CEEC;
        }

        &.step-1 td {
          background:#C6DEFF;
        }
      } // tr
    } // table.listing
  }
}

/* input fields take whole width */
#event-title,
#event-location,
#category,
#event-description {
	-moz-box-sizing: border-box;
	box-sizing: border-box;
	width: 100%;
	margin: 3px 0;
}
/* bigger event title in detail view */
#event-title {
	font-size: 20px;
}
/* group from and to date fields */
#event-time {
	display: block;
	margin: 5px 0;
}
#event-time-from {
	float: left;
}
#event-time-to {
	float: right;
}
#from, #to {
	width: 12ex;
	margin: 0;
}
#fromtime, #totime {
	width: 80px;
	margin: 0;
}
#event-allday {
	display: inline-block;
	margin: 7px 0;
}
/* whole line for buttons of 'Advanced' and 'Export' */
#advanced_options_button,
#editEvent-export {
	display: block;
	margin: 3px 0;
}
/* normal font weight for secondary buttons for less obtrusiveness */
/* #advanced_options_button, */
/* #editEvent-export, */
/* #editEvent-delete { */
/* 	font-weight: normal; */
/* } */

#advanced_options {
  display:none;
}
#advanced_options_button, #advanced_options_button_repeat {
  background-position: 4px center;
  background-repeat: no-repeat;
  background-size: 24px;
  padding-left:32px;
  &.options-visible {
    background-image:url('../../../core/img/actions/triangle-n.svg');
  }
  &:not(.options-visible) {
    background-image:url('../../../core/img/actions/triangle-s.svg');
  }
}

/* more space for action buttons below */
#actions {
	height: 45px;
}

#submitNewEvent {
    background-color: var(--color-primary-element);
}

/* make popups scrollable in smaller viewports */
.ui-dialog.cafevdb-project-events {
	max-height: 75% !important;
	/*top: 15% !important;*/
	overflow-y: auto;
	overflow-x: hidden;
	padding: 0;
/*        min-width:30em;*/
}

.ui-dialog.cafevdb-project-events .ui-dialog-content {
	overflow: initial;
}

div.google-popup {
  overflow:hidden;
  max-height:none !important;
}

/* Hide the category selector. We use the categories to link events to
 * projects, or at least to restore event-project connection. Better not
 * let the user fiddle with that.
 */
.cafevdb.eventdlg {
  input#category, a#editCategories {
    /*  display:none;*/
  }
  #event-allday {
    display: inline-block;
    margin: 7px 0;
    width: 100%;
  }
  .actions {
    height: 33px;
    min-width: 800px;
  }
  #editEvent-submit {
    background-color:var(--color-primary-element);
    border-color:var(--color-primary-element);
    color:var(--color-primary-text);
  }
  div.flex-container {
    display:flex;
    flex-flow: row nowrap;
  }
  span.flex-container {
    display:inline-flex;
  }
  .flex-container {
    &.flex-center {
      align-items:center;
    }
    &.flex-baseline {
      align-items:baseline;
    }
    &.flex-justify-full {
      justify-content:space-between;
    }
    input, .button {
      flex: 4 1 90%;
      &.no-flex {
        flex:0 0 auto;
      }
    }
    a.action {
      margin-left: 0.5em;
      flex: 0 1;
      height:32px;
      padding-top:4px;
      padding-bottom:4px;
      img {
        height:24px;
      }
    }
    .button.calendar-app {
      margin:3px 0;
      line-height:1em;
    }
  }
}

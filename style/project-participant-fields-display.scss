/**
 * Orchestra member, musicion and project management application.
 *
 * CAFEVDB -- Camerata Academica Freiburg e.V. DataBase.
 *
 * @author Claus-Justus Heine
 * @copyright 2011-2016, 2021, 2022, 2023 Claus-Justus Heine <himself@claus-justus-heine.de>
 * @license AGPL-3.0-or-later
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 */

/******************************************************************************
 *
 * display of project-participant-field data.
 *
 */

@import 'pme-table-tabs.scss';

form.pme-form.project-participant-fields-display {

  table.pme-main {
    @for $id from 0 through 15 {
      @include tableTabDisplay($id, "none", "&", ".project-fees-details");
    }
    &.pme-filter-visible, &.pme-sortinfo-visible {
      @for $id from 0 through 15 {
        @include tableTabDisplay($id, "table-cell", "&", ".project-fees-details");
        @include tableTabDisplay($id, "none", "&", ".project-fees-summary");
      }
    }
  }

  .total-project-fees.money {
    span.finance-state {
      font-weight:bold;
      padding:0.2em;
    }
    span.totals, span.invoiced {
      color:black;
    }
    span.received {
      color:blue;
    }
    span.outstanding {
      color:red;
    }
  }

  span.allowed-option {
    display:inline-block;
    width:100%;
    position:relative;
    text-align:justify;
  }

  &:not(.pme-change) {
    span.allowed-option-name:empty {
      &, & ~ span.allowed-option-separator {
        &, & ~ span.allowed-option-value:empty {
          display:none;
        }
      }
    }

    td:not(.pme-key) {
      &.groupofpeople,
      &.groupofpeople-id,
      &.receivables.set,
      &.receivables.enum,
      &.liabilities.set,
      &.liabilities.enum {
        min-width:12em;
      }
    }

    td.enum {
      &.receivables,
      &.liabilities {
        font-family:inherit;
      }
    }

    span.allowed-option-name {
      max-width:5em;
      float:left; // Mmmh.
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      /*position:absolute;*/ /* needs position != static on parent */
      /*left:0;*/
      &.money {
        &.liabilities {
          color:red;
        }
        &.receivables {
          color:blue;
        }
      }
    }

    span.allowed-option-value.money {
      font-family:monospace;
      float:right;
      white-space:nowrap;
      /*position:absolute;*/
      /*right:0;*/
      &.liabilities {
        color:red;
      }
      &.receivables {
        color:blue;
      }
    }

    span.allowed-option.group {
      width:100%;
    }

    td.money.simple-valued {
      &.pme-cell, &.pme-value {
        font-family:monospace;
      }
      &.groupofpeople {
        font-family:inherit;
      }
    }
  }

  &:not(.pme-change, .pme-list) {
    td:not(.pme-keys)  {
      &.groupofpeople,
      &.groupofpeople-id,
      &.receivables.set,
      &.receivables.enum,
      &.liabilities.set,
      &.liabilities.enum {
        width:32em;
      }
    }
  }

  td.pme-value.simple-valued.money input {
    &[type=text], &[type=number] {
      font-family:monospace;
    }
  }

  span.currency-symbol {
    font-weight:bold;
    font-family:monospace;
    font-size:1em;
    margin-right:1em;
  }

  input[type=button].display-postfix {
    background-repeat:no-repeat;
    background-size: 24px 24px;
    vertical-align:middle;
    margin-right:1em;

    &.image-left-of-text {
      background-position: 2px center;
      padding-left:28px;
    }

    &.hidden-text {
      background-position:center;
      width:28px;
      height:28px;
      min-width:28px;
      min-height:28px;
      text-indent:-10000em;
      vertical-align:middle;
      padding:0;
    }

    &.revert-to-default {
      background-image:url('../img/history.svg');
    }
  }

  tr.recurring td.pme-value td.label {
    // padding-left:0.5em;
    padding-right:0.5em;
  }

  &.pme-view, &.pme-delete {
    span.allowed-option-name {
      max-width:12em;
    }
    span.allowed-option-name, span.allowed-option-value.money {
      /* float:unset; */
    }
    td.receivables,
    td.liabilities {
      span.allowed-option-name:after {
        content: ": ";
      }
    }

    td.set {
      &.receivables,
      &.liabilities {
        span.allowed-option-value.money {
          font-family:monospace;
          /* font-size:120%; */
          /* position:absolute; */
          /* left:12em; */
          float:right;
        }
        position:relative;
      }
    }
  }

  &.pme-add, &.pme-change, &.pme-copy {
    td.pme-key.single-valued {
      &.receivables,
      &.liabilities {
        position:relative;
      }
    }
    width:100%;
    .file-upload-wrapper td.input {
      width:100%;
    }
  }

  /* The following can be used to style the money labels. */
  &.pme-change, &.pme-add, &.pme-delete {
    td.pme-key.single-valued {
      &.receivables,
      &.liabilities {
        span.allowed-option-name.money {
          /* margin-right:6em; */ /* leave room for absolute positioned money value */
        }
      }
    }

    td.pme-key.single-valued {
      &.receivables,
      &.liabilities {
        span.allowed-option-value.money {
          font-family:monospace;
          float:right;
          /* position:absolute; */
          /* right:1em; */
        }
      }
    }
  }

  span.allowed-option-name ~ span.allowed-option-value {
    /* margin-left:1ex; */
  }

  label.groupofpeople {
    span.allowed-option {
      margin-left:1ex;
      display:none;
    }

    &.single-valued span.allowed-option,
    &.predefined span.allowed-option.selected {
      display:unset;
      font-weight:bold;
    }
  }

  td.pme-value, td.pme-cell {
    input.sepa-debit-mandate {
      min-height:unset;
      margin:0;
      padding: 2px 12px 2px 12px;
    }
  }

  /**
   * Style first and subsequence lines in list-view
   */
  &.pme-list {
    td.pme-value, td.pme-cell {
      div.allowed-option-wrapper {
        max-height:24px; /* hard restriction on table row height */
        /* line-height:12px; */
        line-height:7px;
        font-size:66.67%;
        overflow:hidden;
        position:relative;
        & > *:first-child {
          line-height:12px;
          font-size:150%; /* this is relative to the 2/3 above */
        }
        & > * {
          /* -moz-transform: scale(0.5);
             zoom: 0.5; */
        }
      }
    }
  }

  /**
   * Style files-app links
   */
  &.pme-list, &.pme-view, &.pme-delete {
    td.pme-value, td.pme-cell {
      &.data-type-db-file,
      &.data-type-cloud-file,
      &.data-type-cloud-folder,
      &.data-type-receivables,
      &.data-type-liabilities {
        padding:1px 3px;
        .operation {
          display:inline-block;
          background-repeat:no-repeat;
          background-size: 20px 20px;
          background-position: center;
          width:24px;
          height:24px;
          min-height:unset;
          margin:0;
          vertical-align:middle;
          padding:4px;
          margin-right:0.5em;
          &.open-parent {
            background-image:url('../../../core/img/filetypes/folder-external.svg');
          }
          & ~ .allowed-option-wrapper {
            display:inline-block;
          }
        }
      }
    }
  }

  tr.participant-field {
    &.data-type-receivables,
    &.data-type-liabilities {
      td.pme-value {
        .documents {
          .action-menu-toggle {
            min-height:0;
            width:34px;
            height:34px;
          }
          .dropdown-content {
            .menu-item {
              .delete-undelete .menu-icon {
                background-image:url('../img/cafevdb-delete.svg');
              }
              .upload-replace .menu-icon {
                background-image:url('../../../core/img/actions/upload.svg');
              }
              .upload-from-cloud .menu-icon {
                background-image:url('../img/cloud-icon.svg');
              }
              .open-parent .menu-icon {
                background-image:url('../../../core/img/filetypes/folder-external.svg');
              }
              .download-link .menu-icon {
                background-image:url('../../../core/img/actions/download.svg');
              }
            }
          }
          .download-link.button {
            background-image:url('../../../core/img/actions/download.svg');
            background-repeat: no-repeat;
            background-position: center;
            font-size: 0;
          }
        }
      }
    }
  }

  tr.participant-field.recurring {
    td.pme-value {
      table {
        border-collapse:collapse;
        &.data-type-db-file thead {
          display:none;
        }
        &.recurring-option-recompute-button-disable {
          td.operations input.operation.regenerate {
            display:none;
          }
        }
        &.recurring-generator-manually {
          td.operations {
            input.operation.regenerate-all {
              background-image:url('../../../core/img/actions/add.svg');
            }
          }
        }
        &.show-empty-labels {
          &.hide-empty-values {
            tr.empty-option-value:not(.empty-option-label) {
              display:none;
            }
          }
        }
        &:not(.show-empty-labels) {
          &.hide-empty-values {
            tr.empty-option-value {
              display:none;
            }
          }
        }
        &:not(.has-empty-labelled-values) {
          .show-empty-options {
            display:none;
          }
        }

        th {
          .column-heading {
            padding-right: 0.5em;
          }
        }
        td.operations {
          padding-right:0.5em;
          input.operation.regenerate-all {
            width:auto;
            height:unset;
            min-height:unset;
            margin-right:unset;
            /*background-image:url('../img/reload-solid.svg');*/
            background-image:url('../img/actions/compute-red.svg');
            background-size: 24px 24px;
            background-position: 2px center;
            background-repeat:no-repeat;
            padding-left:32px;
          }
          label.recurring-receivables-update-strategy {
            margin-left:1em;
            &.update-strategy-count-0, &.update-strategy-count-1 {
              display:none;
            }
          }
          input.operation {
            background-repeat:no-repeat;
            background-size: 24px 24px;
            background-position: center;
            width:28px;
            height:28px;
            vertical-align:middle;
            /* margin-right:0.5em; */
            &.regenerate {
              /*background-image:url('../img/reload-solid.svg');*/
              background-image:url('../img/actions/compute-red.svg');
            }
            &.delete-undelete {
              background-image:url('../img/cafevdb-delete.svg');
            }
            &.busy {
              background-image:url('../../../core/img/loading.gif') !important;
            }
          }
          // style the visibility toggle
          input[type="checkbox"].show-empty-options {
	    position: absolute;
	    left: -10000px;
	    top: auto;
	    width: 1px;
	    height: 1px;
	    overflow: hidden;
            + label::after {
	      border-radius: 1px;
	      height: 14px;
	      width: 14px;
	      box-shadow: none !important;
	      background-position: center;

	      content: '';
	      display: inline-block;
	      vertical-align: middle;
	      margin: 0 6px 3px 3px;
	      border: 1px solid #878787;
            }
            &:checked, &:indeterminate {
              + label::after {
	        background-color: var(--color-primary-element);
	        border-color: var(--color-primary-element);
              }
            }
            &:checked {
              + label::after {
	        background-image: url('../../../core/img/actions/checkbox-mark.svg');
              }
            }
          }
        }
        tr.deleted {
          input.operation.delete-undelete {
            background-image:url('../img/history.svg');
          }
          td.input * {
            opacity:0.5;
          }
        }
        &.row-count-0 thead  {
          display:none;
        }
        tr.field-datum {
          td.label {
            width:80%;
          }
          td.input {
            width:80%;
          }
          td.label, td.input {
            position:relative;
            label.lock-unlock.left-of-input.position-right {
              right:0;
              margin-right:4px;
            }
            input:not([type=checkbox]) {
              width:100%;
            }
          }
          td.input {
            width:100%;
          }
          td.label {
            min-width: 10em;
          }
        }
        tr.generator {
          border-top: 1px solid black;
          .flex-container {
            flex-flow:row nowrap;
            display:inline-flex;
            align-items:center;
            justify-content:space-between;
          }
        }
        th, td {
          &.label.unlabelled {
            // display:none;
          }
        }
      }
    }
  }

  td.pme-value {
    &.cloud-file, &.cloud-folder {
      table.file-upload {
        width:100%;
      }
    }
  }

  tr.file-upload-row {
    td.cloud-file, td.cloud-folder {
      width:100%;
      padding-right:3px;
    }

    td.operations {
      padding-right:0.5em;
      .operation {
        display:inline-block;
        background-repeat:no-repeat;
        background-size: 24px 24px;
        background-position: center;
        width:28px;
        height:28px;
        vertical-align:middle;
        /* margin-right:0.5em; */
        &.delete-undelete {
          background-image:url('../img/cafevdb-delete.svg');
        }
        &.upload-replace {
          background-image:url('../../../core/img/actions/upload.svg');
        }
        &.upload-from-cloud {
          background-image:url('../img/cloud-icon.svg');
        }
        &.open-parent {
          background-image:url('../../../core/img/filetypes/folder-external.svg');
        }
      }
    }

    a[href=""] {
      display:none;
    }

    a ~ .upload-placeholder {
      display:none;
    }

    a[href=""] ~ .upload-placeholder {
      display:inline-block;
      width:100%;
    }
  }
}

.tooltip-inner {
  span.allowed-option {
    display:inline-block;
    width:100%;
  }
  span.allowed-option-name {
    font-style:italic;
    &.money {
      &.liabilities {
        color:red;
      }
      &.receivables {
        color:blue;
      }
    }
  }
  span.allowed-option-separator {
    display:inline-block;
    width:1em;
  }
  span.allowed-option-value.money {
    font-family:monospace;
    float:right;
    &.liabilities {
      color:red;
    }
    &.receivables {
      color:blue;
    }
  }
  .operation {
    display:none;
  }
}
